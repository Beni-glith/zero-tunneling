name: üîí Auto Encrypt GitHub Files

on:
  workflow_dispatch: # Hanya manual trigger
  schedule:
    - cron: '0 3 * * *' # Auto-run setiap jam 3 pagi UTC

jobs:
  encrypt-files:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    # ----------------------------------------
    # 1. CHECKOUT SELURUH REPOSITORY
    # ----------------------------------------
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # ----------------------------------------
    # 2. SETUP ENVIRONMENT (FIXED)
    # ----------------------------------------
    - name: Setup Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y shc  # Pakai versi pre-built dari Ubuntu
        shc -v || echo "SHC installed"

    # ----------------------------------------
    # 3. ENKRIPSI FILE (Disesuaikan dengan repo Anda)
    # ----------------------------------------
    - name: Encrypt Important Files
      run: |
        # Buat folder untuk hasil enkripsi
        mkdir -p encrypted
        
        # Daftar file yang akan dienkripsi (sesuaikan dengan repo Anda)
        declare -a files=("build.sh" "payload.sh" "config.cfg" "install.sh")
        
        for file in "${files[@]}"; do
          if [ -f "$file" ]; then
            echo "üîê Encrypting $file..."
            shc -f "$file" -o "encrypted/$file"
            chmod +x "encrypted/$file"
            echo "‚úÖ Berhasil: encrypted/$file"
          else
            echo "‚ö†Ô∏è File $file tidak ditemukan, dilewati"
          fi
        done

        # Verifikasi hasil
        echo "üìÇ Hasil enkripsi:"
        ls -la encrypted/

    # ----------------------------------------
    # 4. UPDATE REPOSITORY (Optional)
    # ----------------------------------------
    - name: Push Encrypted Files
      if: success()
      run: |
        git config --global user.name "GitHub Encrypt Bot"
        git config --global user.email "actions@github.com"
        git add encrypted/
        git commit -m "üîí Auto-encrypted files [$(date +'%d-%m-%Y %H:%M')]"
        git push
