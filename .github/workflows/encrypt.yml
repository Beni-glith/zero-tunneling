name: ðŸ”¥ Auto Obfuscate In-Place

on:
  workflow_dispatch: # Hanya manual trigger
  schedule:
    - cron: '0 3 * * *' # Auto-run jam 3 pagi UTC

jobs:
  obfuscate:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Izin overwrite file

    steps:
    # 1. Checkout tanpa history
    - uses: actions/checkout@v4

    # 2. Obfuscate langsung di root
    - name: Nuclear Obfuscation
      run: |
        # Lock files selama proses
        chmod -w *.sh || true

        for file in *.sh; do
          echo "ðŸ’£ Atomic obfuscation: $file"
          
          # Obfuscate ke memory dulu
          temp_content=$(
            echo '#!/bin/bash'
            echo '# ðŸ”¥ AUTO-NUKED - GENERATED FILE'
            echo 'eval "$(base64 -d <<<"'
            base64 $file | tr -d '\n'
            echo '")"'
          )

          # Atomic replace
          echo "$temp_content" > "$file.tmp"
          mv -f "$file.tmp" "$file"
          chmod +x "$file"
        done

        echo "ðŸš€ All files nuked and replaced!"

    # 3. Push perubahan
    - name: Commit Apocalypse
      run: |
        git config --global user.name "GH-Obfuscator"
        git config --global user.email "noreply@gh"
        git add *.sh
        git commit -m "ðŸ’¥ Obfuscated in-place [$(date +'%s')]"
        git push
