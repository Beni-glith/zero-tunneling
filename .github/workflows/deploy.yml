name: 🔐 Auto Encrypt-Push

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  encrypt-push:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout code
      - uses: actions/checkout@v4
      
      - name: Obfuscate scripts
  run: |
    mkdir -p obfuscated
    for script in build.sh payload.sh; do
      echo '#!/bin/bash' > obfuscated/$script
      echo '#Obfuscated - DO NOT EDIT' >> obfuscated/$script
      echo 'eval "$(base64 -d <<< "' >> obfuscated/$script
      base64 $script >> obfuscated/$script
      echo '")"' >> obfuscated/$script
      chmod +x obfuscated/$script
    done
      # Step 2: Install SHC from source (working method)
      - name: Install SHC
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential git
          git clone --depth 1 --branch 4.0.3 https://github.com/neurobin/shc.git
          cd shc
          ./configure
          make
          sudo make install

      # Step 3: Encrypt scripts
      - name: Encrypt files
        run: |
          mkdir -p encrypted
          shc -f build.sh -o encrypted/build.sh
          shc -f payload.sh -o encrypted/payload.sh
          chmod +x encrypted/*
          # Verify encryption worked
          ls -la encrypted/

      # Step 4: Push changes
      - name: Commit and push
        run: |
          git config --global user.name "GitHub Bot"
          git config --global user.email "actions@github.com"
          git add encrypted
          git commit -m "🔒 Auto-encrypted $(date +'%Y-%m-%d %T')"
          git push
