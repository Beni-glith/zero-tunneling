name: üîê Auto Encrypt-Push

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  encrypt-push:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout code
      - uses: actions/checkout@v4

      # Step 2: Setup Docker and encrypt scripts
      - name: Encrypt scripts with SHC
        run: |
          mkdir -p encrypted
          docker run --rm -v $PWD:/scripts -w /scripts alpine sh -c "
            apk add --no-cache git build-essential gcc make &&
            git clone https://github.com/neurobin/shc /tmp/shc &&
            cd /tmp/shc &&
            ./configure &&
            make &&
            make install &&
            cd /scripts &&
            shc -f payload.sh -o encrypted/payload.sh &&
            shc -f build.sh -o encrypted/build.sh
          "
          chmod +x encrypted/*

      # Step 3: Push changes
      - name: Commit and push
        run: |
          git config --global user.name "GitHub Bot"
          git config --global user.email "actions@github.com"
          git add encrypted
          git commit -m "üîí Auto-encrypted $(date +'%Y-%m-%d %T')"
          git push
