name: 🔐 Auto Encrypt-Push (Fixed Version)

on:
  workflow_dispatch: # Hanya manual trigger

jobs:
  encrypt-push:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    # 1. Checkout kode
    - uses: actions/checkout@v4

    # 2. Install SHC dari package resmi Ubuntu (lebih stabil)
    - name: Install SHC
      run: |
        sudo apt-get update
        sudo apt-get install -y shc
        shc -v  # Verifikasi instalasi

    # 3. Enkripsi script
    - name: Encrypt Scripts
      run: |
        mkdir -p encrypted
        echo "🔒 Starting encryption..."
        
        # Enkripsi semua file .sh di root
        for script in *.sh; do
          echo "Processing $script..."
          shc -f "$script" -o "encrypted/$script" && {
            chmod +x "encrypted/$script"
            echo "✅ Success: $script encrypted"
          } || {
            echo "❌ Failed to encrypt $script"
            exit 1
          }
        done

        echo "📂 Hasil enkripsi:"
        ls -la encrypted/

    # 4. Push hasil
    - name: Push Changes
      run: |
        git config --global user.name "GitHub Bot"
        git config --global user.email "actions@github.com"
        git add encrypted
        git commit -m "🔒 Auto-encrypted $(date +'%Y-%m-%d %H:%M')"
        git push
