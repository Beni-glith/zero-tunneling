name: üîê Auto Encrypt-Push (Fixed)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'

jobs:
  encrypt-push:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout repo
      - uses: actions/checkout@v4

      # 2. Install SHC dari source (metode resmi)
      - name: Install SHC
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential git
          git clone --depth 1 https://github.com/neurobin/shc
          cd shc
          ./configure
          make
          sudo make install
          shc -v  # Verifikasi instalasi

      # 3. Enkripsi script
      - name: Encrypt scripts
        run: |
          mkdir -p encrypted
          for script in *.sh; do
            echo "üîí Encrypting $script..."
            shc -f "$script" -o "encrypted/$script"
            chmod +x "encrypted/$script"
          done
          ls -la encrypted/  # Tampilkan hasil

      # 4. Push otomatis
      - name: Push changes
        run: |
          git config --global user.name "GitHub Bot"
          git config --global user.email "actions@github.com"
          git add encrypted
          git commit -m "üîí Auto-encrypted $(date +'%d-%m-%Y %H:%M')"
          git push
