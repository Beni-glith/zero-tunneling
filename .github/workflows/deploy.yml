name: 🔐 Auto Encrypt-Push

on:
  workflow_dispatch:  # Hanya manual trigger (untuk hindari loop)

jobs:
  encrypt-push:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout tanpa credential
      - uses: actions/checkout@v4
        with:
          persist-credentials: false

      # Step 2: Encrypt dengan SHC (versi pre-built)
      - run: |
          curl -LO https://github.com/neurobin/shc/releases/download/4.0.3/shc-4.0.3.tar.gz
          tar -xzf shc-4.0.3.tar.gz
          cd shc-4.0.3
          ./configure
          make
          sudo make install

          mkdir encrypted
          shc -f install.sh -o encrypted/install.sh
          shc -f build.sh -o encrypted/build.sh
          
      # Step 3: Push dengan GitHub-native auth
      - run: |
          git config --global user.name "AutoBot"
          git config --global user.email "auto@bot.noreply"
          git add encrypted
          git commit -m "🔒 Auto-encrypted $(date +'%Y-%m-%d')"
          git push
